@startuml ATS_Scanner_API_DataFlow
!theme plain
skinparam backgroundColor #FAF9F6
skinparam classBackgroundColor #FFFFFF
skinparam classBorderColor #1E3A8A
skinparam classArrowColor #312E81
skinparam noteBkgColor #FDB813
skinparam noteBorderColor #DAA520
skinparam sequenceActorBackgroundColor #E8F0FE
skinparam sequenceActorBorderColor #1E3A8A

title ATS Scanner 2.0 - API Data Flow & Request/Response Models

' Request Models
class UserCreateRequest {
    email: String (EmailStr)
    password: String (min 6 chars)
    name: String [optional]
}

class UserLoginRequest {
    email: String (EmailStr)
    password: String
}

class VerifyEmailRequest {
    email: String (EmailStr)
    verification_code: String (6 digits)
}

class ScanCreateRequest {
    resume_text: String
    job_description: String
    resume_filename: String [optional]
}

class ScanUploadRequest {
    resume: File (PDF)
    jd: String (FormData)
}

' Response Models
class UserResponse {
    id: String
    email: String
    name: String [optional]
    is_verified: Boolean
    created_at: DateTime
}

class TokenResponse {
    access_token: String
    token_type: String ("bearer")
    user: UserResponse
}

class ScanResponse {
    id: String
    user_id: String
    resume_text: String
    job_description: String
    resume_filename: String [optional]
    ats_score: Number (0-100)
    missing_keywords: Array<String>
    matched_keywords: Array<String>
    ai_feedback: String
    detailed_improvements: Array<Object>
    quick_wins: Array<String>
    strengths: Array<String>
    timestamp: DateTime
}

class ScanSummary {
    id: String
    user_id: String
    resume_filename: String [optional]
    ats_score: Number
    missing_keywords: Array<String>
    matched_keywords: Array<String>
    timestamp: DateTime
}

class ScanListResponse {
    scans: Array<ScanSummary>
    total: Number
}

class AnalysisResponse {
    "JD Match": Number (0-100)
    "MissingKeywords": Array<String>
    "MatchedKeywords": Array<String>
    "Profile Summary": String
    "Detailed Improvements": Array<Improvement>
    "Quick Wins": Array<String>
    "Strengths": Array<String>
}

class Improvement {
    category: String
    issue: String
    suggestion: String
    impact: String
    priority: String (High/Medium/Low)
}

' Relationships
UserCreateRequest --> UserResponse : "POST /api/auth/signup"
UserLoginRequest --> TokenResponse : "POST /api/auth/login"
VerifyEmailRequest --> TokenResponse : "POST /api/auth/verify-email"
ScanCreateRequest --> ScanResponse : "POST /api/scans"
ScanUploadRequest --> ScanResponse : "POST /api/scans/upload"
ScanResponse --> AnalysisResponse : "contains"
AnalysisResponse --> Improvement : "includes"

note right of UserCreateRequest
  **Signup Flow**
  1. User submits email, password, name
  2. Backend validates input
  3. Hashes password with bcrypt
  4. Creates user in MongoDB
  5. Sends verification email (if enabled)
  6. Returns user data + token
end note

note right of ScanCreateRequest
  **Analysis Flow**
  1. User submits resume text + JD
  2. Backend validates input
  3. Sends to Gemini LLM
  4. Parses JSON response
  5. Saves to MongoDB
  6. Returns analysis results
end note

note right of AnalysisResponse
  **LLM Output Structure**
  - ATS Match Score (0-100)
  - Keyword Analysis
  - Profile Summary
  - Detailed Improvements
  - Quick Wins
  - Strengths
end note

note right of ScanListResponse
  **Dashboard Data**
  - Lightweight summaries
  - Excludes large text fields
  - Sorted by timestamp
  - Paginated results
end note

@enduml
